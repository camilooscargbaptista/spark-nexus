<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Spark Nexus</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="navbar-brand">ðŸš€ Spark Nexus</a>
            <ul class="navbar-menu">
                <li><a href="/" class="active">Dashboard</a></li>
                <li><a href="/upload">Email Validator</a></li>
                <li><a href="#" onclick="showProfile()">Perfil</a></li>
                <li><a href="#" onclick="auth.logout()">Sair</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container" style="margin-top: 30px;">
        <h1 style="color: white; margin-bottom: 30px;">Bem-vindo ao Spark Nexus</h1>
        
        <!-- Stats Grid -->
        <div class="dashboard-grid">
            <!-- Email Validator Card -->
            <div class="stat-card" style="cursor: pointer;" onclick="window.location.href='/upload'">
                <h3>ðŸ“§ Email Validator</h3>
                <div class="value">Validar Emails</div>
                <p style="color: #718096; margin-top: 10px;">
                    Valide listas de emails em lote com alta precisÃ£o
                </p>
                <button class="btn btn-primary" style="margin-top: 15px;">
                    Acessar MÃ³dulo â†’
                </button>
            </div>

            <!-- CRM Connector Card -->
            <div class="stat-card">
                <h3>ðŸ”— CRM Connector</h3>
                <div class="value">Em Breve</div>
                <p style="color: #718096; margin-top: 10px;">
                    IntegraÃ§Ã£o com principais CRMs do mercado
                </p>
                <span style="background: #fef2e8; color: #c05621; padding: 5px 10px; border-radius: 5px; font-size: 12px;">
                    Em desenvolvimento
                </span>
            </div>

            <!-- Lead Scorer Card -->
            <div class="stat-card">
                <h3>ðŸŽ¯ Lead Scorer AI</h3>
                <div class="value">Em Breve</div>
                <p style="color: #718096; margin-top: 10px;">
                    Score automÃ¡tico com Machine Learning
                </p>
                <span style="background: #fef2e8; color: #c05621; padding: 5px 10px; border-radius: 5px; font-size: 12px;">
                    Em desenvolvimento
                </span>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="card" style="margin-top: 40px;">
            <h2 style="margin-bottom: 20px;">ðŸ“Š Atividade Recente</h2>
            <div id="recentActivity">
                <p style="color: #718096;">Nenhuma atividade recente</p>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="dashboard-grid" style="margin-top: 30px;">
            <div class="stat-card">
                <h3>Total de ValidaÃ§Ãµes</h3>
                <div class="value" id="totalValidations">0</div>
                <div class="change">â†‘ 0% este mÃªs</div>
            </div>

            <div class="stat-card">
                <h3>Taxa de Sucesso</h3>
                <div class="value" id="successRate">0%</div>
                <div class="change">â†‘ 0% melhor que mÃ©dia</div>
            </div>

            <div class="stat-card">
                <h3>Emails Processados</h3>
                <div class="value" id="totalEmails">0</div>
                <div class="change">Hoje</div>
            </div>
        </div>
    </div>

    <script src="/js/auth.js"></script>
    <script>
        // Proteger rota
        if (!auth.protectRoute()) {
            // SerÃ¡ redirecionado para login
        } else {
            // Carregar dados do usuÃ¡rio
            const user = auth.getUser();
            console.log('UsuÃ¡rio logado:', user);
            
            // Carregar estatÃ­sticas
            loadDashboardStats();
        }

        async function loadDashboardStats() {
            try {
                const response = await auth.authenticatedFetch('/api/stats');
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('totalValidations').textContent = stats.totalValidations || 0;
                    document.getElementById('successRate').textContent = (stats.successRate || 0) + '%';
                    document.getElementById('totalEmails').textContent = stats.totalEmails || 0;
                }
            } catch (error) {
                console.log('Stats em modo demo');
                // Valores demo
                document.getElementById('totalValidations').textContent = '156';
                document.getElementById('successRate').textContent = '87%';
                document.getElementById('totalEmails').textContent = '3,428';
            }
        }

        function showProfile() {
            const user = auth.getUser();
            alert(`Perfil:\n\nNome: ${user.firstName || 'Demo'} ${user.lastName || 'User'}\nEmail: ${user.email || 'demo@sparknexus.com'}\nEmpresa: ${user.company || 'Spark Nexus'}`);
        }
    </script>
</body>
</html>
